package problem0928

import "sort"

func minMalwareSpread(graph [][]int, initial []int) int {
	size := len(graph)

	infected := make([]bool, size)
	for _, i := range initial {
		infected[i] = true
	}

	var dfs func(int, []bool) (int, bool)
	dfs = func(i int, hasSeen []bool) (int, bool) {
		if infected[i] {
			return 0, false
		}
		count := 1
		hasSeen[i] = true
		for j := 0; j < size; j++ {
			if graph[i][j] == 0 || hasSeen[j] {
				continue
			}
			if c, ok := dfs(j, hasSeen); ok {
				count += c
			} else {
				return 0, false
			}
		}
		return count, true
	}

	sort.Ints(initial)
	res := initial[0]
	maxCount := 0

	for _, i := range initial {
		count, isUseful := 0, false
		hasSeen := make([]bool, size)
		hasSeen[i] = true
		for j := 0; j < size; j++ {
			if graph[i][j] == 0 {
				continue
			}
			c, ok := dfs(j, hasSeen)
			count += c
			isUseful = isUseful || ok
		}
		if isUseful && maxCount < count {
			maxCount = count
			res = i
		}
	}

	return res
}
